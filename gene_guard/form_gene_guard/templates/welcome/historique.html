{% extends 'welcome/base.html'%}
{% load static%}
{% block content%}
<link rel="stylesheet" href="{% static 'css/login.css' %}">

<div class="profile-container">
    <!-- Header -->
    <div class="profile-header">
        <div class="profile-avatar">
            <i class="fas fa-history"></i>
        </div>
        <div class="profile-info">
            <h1>Historique des Tests</h1>
            <p><i class="fas fa-flask"></i> {{ total_tests }} test(s) effectué(s)</p>
        </div>
    </div>

    <!-- Stats -->
    <div class="profile-stats">
        <div class="stat-card">
            <h3>Tests Drépanocytose</h3>
            <span class="value">{{ sickle_results|length }}</span>
        </div>
        <div class="stat-card">
            <h3>Tests Cholestérol</h3>
            <span class="value">{{ cholesterol_results|length }}</span>
        </div>
        <div class="stat-card">
            <h3>Total</h3>
            <span class="value">{{ total_tests }}</span>
        </div>
    </div>

    <!-- Sickle Cell Results -->
    <div class="profile-section">
        <div class="profile-section-header">
            <i class="fas fa-dna"></i>
            <h2>Tests Drépanocytose (Sickle Cell)</h2>
        </div>
        <div class="profile-section-content">
            {% if sickle_results %}
            <table class="test-history-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Date</th>
                        <th>Statut</th>
                        <th>Détails</th>
                    </tr>
                </thead>
                <tbody>
                    {% for result in sickle_results %}
                    <tr>
                        <td>#{{ result.user_id }}</td>
                        <td>{{ result.created_at|date:"d/m/Y à H:i" }}</td>
                        <td><span class="status-badge low-risk">Complété</span></td>
                        <td>
                            <button onclick="toggleDetails('sickle-{{ result.user_id }}')"
                                style="background: linear-gradient(135deg, #00A651, #00B4D8); color: white; border: none; padding: 8px 15px; border-radius: 20px; cursor: pointer; font-size: 12px;">
                                <i class="fas fa-eye"></i> Voir
                            </button>
                        </td>
                    </tr>
                    <tr id="sickle-{{ result.user_id }}" style="display: none;">
                        <td colspan="4" style="background: #f8fffe; padding: 20px;">
                            <strong>Réponses du test :</strong>
                            <pre
                                style="background: #e8f5e9; padding: 15px; border-radius: 10px; margin-top: 10px; overflow-x: auto; font-size: 13px;">{{ result.responses }}</pre>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="empty-state">
                <i class="fas fa-clipboard-list"></i>
                <p>Aucun test de drépanocytose effectué</p>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Cholesterol Results -->
    <div class="profile-section">
        <div class="profile-section-header">
            <i class="fas fa-heartbeat"></i>
            <h2>Tests Hypercholestérolémie</h2>
        </div>
        <div class="profile-section-content">
            {% if cholesterol_results %}
            <table class="test-history-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Date</th>
                        <th>Statut</th>
                        <th>Détails</th>
                    </tr>
                </thead>
                <tbody>
                    {% for result in cholesterol_results %}
                    <tr>
                        <td>#{{ result.user_id }}</td>
                        <td>{{ result.created_at|date:"d/m/Y à H:i" }}</td>
                        <td><span class="status-badge low-risk">Complété</span></td>
                        <td>
                            <button onclick="toggleDetails('cholesterol-{{ result.user_id }}')"
                                style="background: linear-gradient(135deg, #00A651, #00B4D8); color: white; border: none; padding: 8px 15px; border-radius: 20px; cursor: pointer; font-size: 12px;">
                                <i class="fas fa-eye"></i> Voir
                            </button>
                        </td>
                    </tr>
                    <tr id="cholesterol-{{ result.user_id }}" style="display: none;">
                        <td colspan="4" style="background: #f8fffe; padding: 20px;">
                            <strong>Réponses du test :</strong>
                            <pre
                                style="background: #e8f5e9; padding: 15px; border-radius: 10px; margin-top: 10px; overflow-x: auto; font-size: 13px;">{{ result.responses }}</pre>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="empty-state">
                <i class="fas fa-clipboard-list"></i>
                <p>Aucun test de cholestérol effectué</p>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Actions -->
    <div
        style="text-align: center; margin-top: 30px; display: flex; justify-content: center; gap: 15px; flex-wrap: wrap;">
        <a href="{% url 'ListeMaladie' %}"
            style="display: inline-block; padding: 14px 30px; background: linear-gradient(135deg, #00A651, #00B4D8); color: white; border-radius: 25px; text-decoration: none; font-weight: 600;">
            <i class="fas fa-plus"></i> Nouveau Test
        </a>
        <a href="{% url 'profile' %}"
            style="display: inline-block; padding: 14px 30px; background: #ffffff; color: #00A651; border: 2px solid #00A651; border-radius: 25px; text-decoration: none; font-weight: 600;">
            <i class="fas fa-user"></i> Mon Profil
        </a>
    </div>
</div>

<script>
    function toggleDetails(id) {
        var row = document.getElementById(id);
        if (row.style.display === 'none') {
            row.style.display = 'table-row';
        } else {
            row.style.display = 'none';
        }
    }
</script>
{% endblock %}